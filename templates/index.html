{% extends "base.html" %}

{% block title %}Generate Images - AI Image Generator{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-8 text-center">
            <h1 class="display-4 fw-bold text-primary mb-3">
                Create Stunning Images with AI
            </h1>
            <p class="lead text-muted mb-4">
                Transform your ideas into beautiful images using advanced AI technology. 
                No limits, no restrictions - generate as many images as you want.
            </p>
        </div>
    </div>

    <!-- Generation Interface -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Generation Type Selector -->
            <div class="text-center mb-4">
                <div class="btn-group generation-type-selector" role="group">
                    <input type="radio" class="btn-check" name="generationType" id="imageType" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="imageType">
                        <i class="fas fa-image me-2"></i>Generate Images
                    </label>
                    
                    <input type="radio" class="btn-check" name="generationType" id="videoType" autocomplete="off">
                    <label class="btn btn-outline-primary" for="videoType">
                        <i class="fas fa-video me-2"></i>Generate Videos
                    </label>
                </div>
            </div>
            
            <!-- Image Generation Form -->
            <div class="card shadow-lg border-0 generation-card" id="imageGenerationCard">
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('generate_image') }}" id="generateImageForm">
                        <div class="mb-4">
                            <label for="imagePrompt" class="form-label fw-semibold text-dark">
                                <i class="fas fa-pen-fancy me-2 text-primary"></i>
                                Describe your image
                            </label>
                            <textarea 
                                class="form-control form-control-lg prompt-input" 
                                id="imagePrompt" 
                                name="prompt" 
                                rows="4" 
                                placeholder="A serene mountain landscape at sunset with vibrant orange and pink skies, reflecting in a crystal clear lake..."
                                maxlength="500"
                                required
                            ></textarea>
                            <div class="form-text">
                                <span id="imageCharCount">0</span>/500 characters
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg generate-btn">
                                <i class="fas fa-magic me-2"></i>
                                <span class="btn-text">Generate Image</span>
                                <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Video Generation Form -->
            <div class="card shadow-lg border-0 generation-card d-none" id="videoGenerationCard">
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('generate_video') }}" id="generateVideoForm">
                        <div class="mb-4">
                            <label for="videoPrompt" class="form-label fw-semibold text-dark">
                                <i class="fas fa-video me-2 text-accent"></i>
                                Describe your video
                            </label>
                            <textarea 
                                class="form-control form-control-lg prompt-input" 
                                id="videoPrompt" 
                                name="prompt" 
                                rows="4" 
                                placeholder="A cat gracefully jumping through a field of flowers, slow motion, cinematic lighting..."
                                maxlength="500"
                                required
                            ></textarea>
                            <div class="form-text">
                                <span id="videoCharCount">0</span>/500 characters
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Videos are generated as animated GIFs (5-10 seconds). For best results, describe motion and action.
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-accent btn-lg generate-btn">
                                <i class="fas fa-play me-2"></i>
                                <span class="btn-text">Generate Video</span>
                                <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Images Section -->
    {% if recent_images %}
    <div class="row mt-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-semibold text-dark">
                    <i class="fas fa-clock me-2 text-secondary"></i>
                    Recent Creations
                </h3>
                <a href="{{ url_for('gallery') }}" class="btn btn-outline-primary">
                    View All <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            
            <div class="row g-4">
                {% for image in recent_images %}
                <div class="col-md-6 col-lg-3">
                    <div class="card image-card h-100 border-0 shadow-sm">
                        <div class="image-container">
                            <img 
                                src="{{ url_for('static', filename='images/' + image.image_filename) }}" 
                                class="card-img-top" 
                                alt="Generated image"
                                loading="lazy"
                            >
                            <div class="image-overlay">
                                <a href="{{ url_for('download_image', image_id=image.id) }}" 
                                   class="btn btn-light btn-sm">
                                    <i class="fas fa-download"></i>
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text text-muted small mb-2">
                                {{ image.prompt[:80] }}{% if image.prompt|length > 80 %}...{% endif %}
                            </p>
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                {{ image.created_at.strftime('%b %d, %Y') }}
                            </small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Features Section -->
    <div class="row mt-5 pt-5 border-top">
        <div class="col-md-4 text-center mb-4">
            <div class="feature-icon mb-3">
                <i class="fas fa-infinity text-primary"></i>
            </div>
            <h5 class="fw-semibold">Unlimited Generation</h5>
            <p class="text-muted">Generate as many images as you want without any restrictions or usage limits.</p>
        </div>
        <div class="col-md-4 text-center mb-4">
            <div class="feature-icon mb-3">
                <i class="fas fa-bolt text-success"></i>
            </div>
            <h5 class="fw-semibold">Fast Processing</h5>
            <p class="text-muted">Local AI processing ensures quick generation times and complete privacy.</p>
        </div>
        <div class="col-md-4 text-center mb-4">
            <div class="feature-icon mb-3">
                <i class="fas fa-palette text-accent"></i>
            </div>
            <h5 class="fw-semibold">High Quality</h5>
            <p class="text-muted">Advanced AI models create stunning, high-resolution images from your descriptions.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Generation type switcher
    const imageTypeRadio = document.getElementById('imageType');
    const videoTypeRadio = document.getElementById('videoType');
    const imageCard = document.getElementById('imageGenerationCard');
    const videoCard = document.getElementById('videoGenerationCard');
    
    // Handle type switching
    imageTypeRadio.addEventListener('change', function() {
        if (this.checked) {
            imageCard.classList.remove('d-none');
            videoCard.classList.add('d-none');
        }
    });
    
    videoTypeRadio.addEventListener('change', function() {
        if (this.checked) {
            videoCard.classList.remove('d-none');
            imageCard.classList.add('d-none');
        }
    });
    
    // Character counters
    function setupCharacterCounter(textareaId, counterId) {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(counterId);
        
        if (textarea && counter) {
            textarea.addEventListener('input', function() {
                const length = this.value.length;
                counter.textContent = length;
                
                if (length > 450) {
                    counter.className = 'text-warning';
                } else if (length > 480) {
                    counter.className = 'text-danger';
                } else {
                    counter.className = 'text-muted';
                }
            });
        }
    }
    
    // Setup character counters for both forms
    setupCharacterCounter('imagePrompt', 'imageCharCount');
    setupCharacterCounter('videoPrompt', 'videoCharCount');
    
    // Form submission handling
    document.getElementById('generateImageForm').addEventListener('submit', function(e) {
        const button = this.querySelector('.generate-btn');
        const spinner = button.querySelector('.spinner-border');
        const text = button.querySelector('.btn-text');
        
        button.disabled = true;
        spinner.classList.remove('d-none');
        text.textContent = 'Generating Image...';
    });
    
    document.getElementById('generateVideoForm').addEventListener('submit', function(e) {
        const button = this.querySelector('.generate-btn');
        const spinner = button.querySelector('.spinner-border');
        const text = button.querySelector('.btn-text');
        
        button.disabled = true;
        spinner.classList.remove('d-none');
        text.textContent = 'Generating Video...';
    });
</script>
{% endblock %}
